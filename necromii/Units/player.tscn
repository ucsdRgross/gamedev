[gd_scene load_steps=12 format=3 uid="uid://dtmh7h36yyiyf"]

[ext_resource type="Script" path="res://Units/Player.gd" id="1_dlni2"]
[ext_resource type="PackedScene" uid="uid://lek0jjxj3i5y" path="res://Components/movement_physics.tscn" id="2_k6ysm"]
[ext_resource type="PackedScene" uid="uid://cka37m5i2kq54" path="res://Components/health_bar.tscn" id="2_t0eip"]
[ext_resource type="PackedScene" uid="uid://cq51wxypscfeh" path="res://Units/LittleWitch/little_witch.tscn" id="3_vkmem"]
[ext_resource type="Script" path="res://addons/godot_state_charts/state_chart.gd" id="4_v5nrd"]
[ext_resource type="Script" path="res://addons/godot_state_charts/compound_state.gd" id="5_3sqlo"]
[ext_resource type="Script" path="res://addons/godot_state_charts/atomic_state.gd" id="6_gikej"]
[ext_resource type="Script" path="res://addons/godot_state_charts/transition.gd" id="7_f27yr"]

[sub_resource type="PhysicsMaterial" id="PhysicsMaterial_3d5xi"]
friction = 0.1

[sub_resource type="ViewportTexture" id="ViewportTexture_if78n"]
viewport_path = NodePath("SubViewport")

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_qrji7"]
height = 1.5

[node name="Player" type="RigidBody3D"]
transform = Transform3D(-1, 0, -8.74228e-08, 0, 1, 0, 8.74228e-08, 0, -1, 0, 1.34628, 0)
mass = 10.0
physics_material_override = SubResource("PhysicsMaterial_3d5xi")
script = ExtResource("1_dlni2")

[node name="HealthBar" parent="." instance=ExtResource("2_t0eip")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.00242, 0)
texture = SubResource("ViewportTexture_if78n")

[node name="MovementPhysics" parent="." instance=ExtResource("2_k6ysm")]

[node name="LittleWitch" parent="." instance=ExtResource("3_vkmem")]
transform = Transform3D(-1, 0, -8.74228e-08, 0, 1, 0, 8.74228e-08, 0, -1, 0, -1.333, 0)

[node name="Skeleton3D" parent="LittleWitch/Armature" index="0"]
bones/0/position = Vector3(-0.00658232, 0.360627, -0.287711)
bones/0/rotation = Quaternion(2.89583e-05, 0.707108, 0.707105, -2.89585e-05)
bones/2/rotation = Quaternion(-0.00401858, 4.37318e-08, -0.00209359, 0.99999)
bones/3/rotation = Quaternion(-0.00132433, -3.59822e-12, -0.000689944, 0.999999)
bones/4/rotation = Quaternion(-0.0010529, 1.06109e-11, -0.000548547, 0.999999)
bones/7/rotation = Quaternion(-0.338708, 0.0453762, -0.0256967, 0.939445)
bones/8/rotation = Quaternion(0.0418387, 0.0192294, 0.0260384, 0.9986)
bones/9/rotation = Quaternion(0.0262925, 0.000219257, 0.0332213, 0.999102)
bones/11/rotation = Quaternion(-0.319394, -0.0642062, -0.0417372, 0.944523)
bones/12/rotation = Quaternion(0.0265746, -0.019096, -0.0250272, 0.999151)
bones/13/rotation = Quaternion(0.00401675, -0.000228671, -0.0188766, 0.999814)
bones/14/rotation = Quaternion(0.00761203, -0.0248134, 0.708209, 0.705526)
bones/15/rotation = Quaternion(-0.46469, -0.492261, 0.560882, 0.476606)
bones/16/rotation = Quaternion(8.13862e-05, 0.0500938, -0.0482322, 0.997579)
bones/17/rotation = Quaternion(0.00573717, 0.0261151, -0.707894, 0.705813)
bones/18/rotation = Quaternion(0.470084, -0.485366, 0.56784, -0.470104)
bones/19/rotation = Quaternion(0.000824322, -0.0500689, 0.0416894, 0.997875)

[node name="WiggleBone" parent="LittleWitch/Armature/Skeleton3D" index="1"]
transform = Transform3D(0.999978, -0.00209835, 0.00632484, -0.00666372, -0.309272, 0.95095, -3.93279e-05, -0.950971, -0.30928, -0.00431413, 0.892707, -0.39512)

[node name="AnimationTree" parent="LittleWitch" index="2"]
parameters/RunBlend/blend_amount = 0

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.272481, 0)
shape = SubResource("CapsuleShape3D_qrji7")

[node name="NavigationObstacle3D" type="NavigationObstacle3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.607162, 0)
radius = 1.0

[node name="StateChart" type="Node" parent="."]
script = ExtResource("4_v5nrd")

[node name="Root" type="Node" parent="StateChart"]
script = ExtResource("5_3sqlo")
initial_state = NodePath("Movement")

[node name="Movement" type="Node" parent="StateChart/Root"]
script = ExtResource("5_3sqlo")
initial_state = NodePath("Grounded")

[node name="Grounded" type="Node" parent="StateChart/Root/Movement"]
editor_description = "This state is active when the player is on the ground."
script = ExtResource("6_gikej")

[node name="On Jump" type="Node" parent="StateChart/Root/Movement/Grounded"]
process_mode = 4
editor_description = "When jumping become airborne and enable double-jump."
script = ExtResource("7_f27yr")
to = NodePath("../../Airborne")
event = &"jump"

[node name="On Airborne" type="Node" parent="StateChart/Root/Movement/Grounded"]
editor_description = "When becoming airborne (e.g. through falling) move to airborne state."
script = ExtResource("7_f27yr")
to = NodePath("../../Airborne")
event = &"airborne"

[node name="Airborne" type="Node" parent="StateChart/Root/Movement"]
editor_description = "This is the root state for when the player is in the air. We have sub-states to handle the various input that is allowed when in the air."
script = ExtResource("5_3sqlo")
initial_state = NodePath("CannotJump")

[node name="On Grounded" type="Node" parent="StateChart/Root/Movement/Airborne"]
script = ExtResource("7_f27yr")
to = NodePath("../../Grounded")
event = &"grounded"

[node name="CannotJump" type="Node" parent="StateChart/Root/Movement/Airborne"]
process_mode = 4
editor_description = "This state is active when the player is airborne but can no longer jump either because the coyote-jump grace period has expired or the player has already used the double-jump."
script = ExtResource("6_gikej")

[node name="On Ragdoll" type="Node" parent="StateChart/Root/Movement"]
script = ExtResource("7_f27yr")
to = NodePath("../../Ragdoll")
event = &"ragdoll"

[node name="Ragdoll" type="Node" parent="StateChart/Root"]
script = ExtResource("6_gikej")

[node name="Recover" type="Node" parent="StateChart/Root/Ragdoll"]
script = ExtResource("7_f27yr")
to = NodePath("../../Movement")
delay_seconds = 2.0

[connection signal="jumping" from="MovementPhysics" to="." method="_on_movement_physics_jumping"]
[connection signal="state_physics_processing" from="StateChart/Root/Movement" to="." method="_on_movement_state_physics_processing"]
[connection signal="state_physics_processing" from="StateChart/Root/Movement/Grounded" to="." method="_on_grounded_state_physics_processing"]
[connection signal="state_exited" from="StateChart/Root/Ragdoll" to="." method="_on_ragdoll_state_exited"]

[editable path="LittleWitch"]
