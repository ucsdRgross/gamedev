[gd_scene load_steps=12 format=3 uid="uid://dyueqg0efaw64"]

[ext_resource type="Script" path="res://Units/player_v2.gd" id="1_g1v30"]
[ext_resource type="PackedScene" uid="uid://cka37m5i2kq54" path="res://Components/health_bar.tscn" id="2_o78ao"]
[ext_resource type="PackedScene" uid="uid://cq51wxypscfeh" path="res://Units/LittleWitch/little_witch.tscn" id="4_r7bbg"]
[ext_resource type="Script" path="res://addons/godot_state_charts/state_chart.gd" id="5_t8k2f"]
[ext_resource type="Script" path="res://addons/godot_state_charts/compound_state.gd" id="6_cqq8a"]
[ext_resource type="Script" path="res://addons/godot_state_charts/atomic_state.gd" id="7_u5a48"]
[ext_resource type="Script" path="res://addons/godot_state_charts/transition.gd" id="8_w5fi0"]

[sub_resource type="PhysicsMaterial" id="PhysicsMaterial_3d5xi"]
friction = 0.1

[sub_resource type="CylinderShape3D" id="CylinderShape3D_aimxp"]
height = 0.5

[sub_resource type="ViewportTexture" id="ViewportTexture_8j6s0"]
viewport_path = NodePath("SubViewport")

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_qrji7"]
height = 1.5

[node name="Player" type="RigidBody3D"]
axis_lock_angular_x = true
axis_lock_angular_z = true
mass = 10.0
physics_material_override = SubResource("PhysicsMaterial_3d5xi")
script = ExtResource("1_g1v30")
SPEED = 10.0

[node name="ShapeCast3D" type="ShapeCast3D" parent="."]
shape = SubResource("CylinderShape3D_aimxp")
target_position = Vector3(0, -0.75, 0)

[node name="HealthBar" parent="." instance=ExtResource("2_o78ao")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)
texture = SubResource("ViewportTexture_8j6s0")

[node name="LittleWitch" parent="." instance=ExtResource("4_r7bbg")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.75, 0)

[node name="Skeleton3D" parent="LittleWitch/Armature" index="0"]
bones/0/position = Vector3(-0.0344599, 0.332713, -0.235286)
bones/0/rotation = Quaternion(3.51761e-05, 0.707108, 0.707106, -3.51767e-05)
bones/1/rotation = Quaternion(3.09086e-08, 0.707107, 0.707107, 3.09086e-08)
bones/2/rotation = Quaternion(-0.0203792, 4.39265e-08, -0.0108581, 0.999733)
bones/3/rotation = Quaternion(-0.00631645, 1.1937e-10, -0.00344253, 0.999974)
bones/4/rotation = Quaternion(-0.00335779, 5.22509e-11, -0.00193855, 0.999992)
bones/6/rotation = Quaternion(0.579466, 0.493645, 0.493645, -0.420534)
bones/7/rotation = Quaternion(-0.39819, -0.0234414, -0.260032, 0.879363)
bones/8/rotation = Quaternion(0.136944, 0.021151, 0.134306, 0.981204)
bones/9/rotation = Quaternion(0.134501, 0.00112087, 0.169947, 0.976231)
bones/10/rotation = Quaternion(0.579466, -0.493645, -0.493645, -0.420534)
bones/11/rotation = Quaternion(-0.311867, -0.0807916, -0.089732, 0.942422)
bones/12/rotation = Quaternion(0.0589148, -0.0205754, -0.129271, 0.989644)
bones/13/rotation = Quaternion(0.0206097, -0.00117259, -0.0968584, 0.995084)
bones/14/rotation = Quaternion(0.0390569, 0.0501842, 0.713128, 0.698144)
bones/15/rotation = Quaternion(-0.460209, -0.461786, 0.589659, 0.476722)
bones/16/rotation = Quaternion(0.0165671, 0.0493546, -0.0398992, 0.997847)
bones/17/rotation = Quaternion(0.0294415, -0.0434853, -0.712056, 0.700156)
bones/18/rotation = Quaternion(0.486136, -0.424565, 0.623245, -0.441568)
bones/19/rotation = Quaternion(0.0203812, -0.0491836, 0.0062692, 0.998562)

[node name="LittleWitch2" parent="LittleWitch/Armature/Skeleton3D" index="0"]
blend_shapes/Happy = 1.0

[node name="WiggleBone" parent="LittleWitch/Armature/Skeleton3D" index="1"]
transform = Transform3D(0.999243, -0.0251998, 0.0296319, -0.0373547, -0.40919, 0.911684, -0.0108492, -0.912101, -0.409822, -0.0235704, 0.844574, -0.358386)

[node name="AnimationTree" parent="LittleWitch" index="2"]
parameters/RunBlend/blend_amount = 0

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
shape = SubResource("CapsuleShape3D_qrji7")

[node name="NavigationObstacle3D" type="NavigationObstacle3D" parent="."]
radius = 1.0

[node name="StateChart" type="Node" parent="."]
script = ExtResource("5_t8k2f")

[node name="Root" type="Node" parent="StateChart"]
script = ExtResource("6_cqq8a")
initial_state = NodePath("Movement")

[node name="Movement" type="Node" parent="StateChart/Root"]
script = ExtResource("6_cqq8a")
initial_state = NodePath("Grounded")

[node name="Grounded" type="Node" parent="StateChart/Root/Movement"]
editor_description = "This state is active when the player is on the ground."
script = ExtResource("7_u5a48")

[node name="On Jump" type="Node" parent="StateChart/Root/Movement/Grounded"]
process_mode = 4
editor_description = "When jumping become airborne and enable double-jump."
script = ExtResource("8_w5fi0")
to = NodePath("../../Airborne")
event = &"jump"

[node name="On Airborne" type="Node" parent="StateChart/Root/Movement/Grounded"]
editor_description = "When becoming airborne (e.g. through falling) move to airborne state."
script = ExtResource("8_w5fi0")
to = NodePath("../../Airborne")
event = &"airborne"

[node name="Airborne" type="Node" parent="StateChart/Root/Movement"]
editor_description = "This is the root state for when the player is in the air. We have sub-states to handle the various input that is allowed when in the air."
script = ExtResource("6_cqq8a")
initial_state = NodePath("CannotJump")

[node name="On Grounded" type="Node" parent="StateChart/Root/Movement/Airborne"]
script = ExtResource("8_w5fi0")
to = NodePath("../../Grounded")
event = &"grounded"

[node name="CannotJump" type="Node" parent="StateChart/Root/Movement/Airborne"]
process_mode = 4
editor_description = "This state is active when the player is airborne but can no longer jump either because the coyote-jump grace period has expired or the player has already used the double-jump."
script = ExtResource("7_u5a48")

[node name="On Ragdoll" type="Node" parent="StateChart/Root/Movement"]
script = ExtResource("8_w5fi0")
to = NodePath("../../Ragdoll")
event = &"ragdoll"

[node name="Ragdoll" type="Node" parent="StateChart/Root"]
script = ExtResource("7_u5a48")

[node name="Recover" type="Node" parent="StateChart/Root/Ragdoll"]
script = ExtResource("8_w5fi0")
to = NodePath("../../Movement")
delay_seconds = 2.0

[connection signal="state_physics_processing" from="StateChart/Root/Movement" to="." method="_on_movement_state_physics_processing"]
[connection signal="state_physics_processing" from="StateChart/Root/Movement/Grounded" to="." method="_on_grounded_state_physics_processing"]
[connection signal="state_exited" from="StateChart/Root/Ragdoll" to="." method="_on_ragdoll_state_exited"]

[editable path="LittleWitch"]
